<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Extract data from the database — extractCdmToParquet • GeneralPretrainedModelTools</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Extract data from the database — extractCdmToParquet"><meta property="og:description" content="Extract data from the server for a random sample of persons, and stores them
in the local file system as Parquet files. Has the following features:
Extracts the subset of CDM tables and fields listed here: https://github.com/OHDSI/GeneralPretrainedModelTools/blob/main/inst/tableColumnsToExtract.csv
Can restrict to a sample of person_ids, as specified with the sampleSize argument.
Loads and saves the tables in as many partitions as the user specifies (see partitions argument). The partitioning is done by person_id (or concept_id for the concept and concept_ancestor table), in a way that the n-th partition of each domain table refers to the same person_ids.
Restricts the concept table to  standard concepts only (ie. those concepts that are allowed to be used in the CDM), to save space.
Loading can be done with multiple threads (see maxCores argument) for speedup.
If the process is interrupted for some reason (e.g. the server drops the connection) you can just restart it and it will pick up where it left off. (unless forceRestart = TRUE) .

"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">GeneralPretrainedModelTools</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Extract data from the database</h1>
    
    <div class="hidden name"><code>extractCdmToParquet.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Extract data from the server for a random sample of persons, and stores them
in the local file system as Parquet files. Has the following features:</p><ul><li><p>Extracts the subset of CDM tables and fields listed here: https://github.com/OHDSI/GeneralPretrainedModelTools/blob/main/inst/tableColumnsToExtract.csv</p></li>
<li><p>Can restrict to a sample of person_ids, as specified with the <code>sampleSize</code> argument.</p></li>
<li><p>Loads and saves the tables in as many partitions as the user specifies (see <code>partitions</code> argument). The partitioning is done by person_id (or concept_id for the concept and concept_ancestor table), in a way that the n-th partition of each domain table refers to the same person_ids.</p></li>
<li><p>Restricts the concept table to  standard concepts only (ie. those concepts that are allowed to be used in the CDM), to save space.</p></li>
<li><p>Loading can be done with multiple threads (see <code>maxCores</code> argument) for speedup.</p></li>
<li><p>If the process is interrupted for some reason (e.g. the server drops the connection) you can just restart it and it will pick up where it left off. (unless <code>forceRestart = TRUE</code>) .</p></li>
</ul></div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">extractCdmToParquet</span><span class="op">(</span></span>
<span>  <span class="va">connectionDetails</span>,</span>
<span>  <span class="va">cdmDatabaseSchema</span>,</span>
<span>  <span class="va">workDatabaseSchema</span>,</span>
<span>  partitionTablePrefix <span class="op">=</span> <span class="st">"GPM_"</span>,</span>
<span>  <span class="va">folder</span>,</span>
<span>  sampleSize <span class="op">=</span> <span class="fl">1e+06</span>,</span>
<span>  partitions <span class="op">=</span> <span class="fl">200</span>,</span>
<span>  maxCores <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  forceRestart <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  dropPartitionTablesWhenDone <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>connectionDetails</dt>
<dd><p>An R object of type <code>connectionDetails</code> created using the
<code><a href="https://ohdsi.github.io/DatabaseConnector/reference/createConnectionDetails.html" class="external-link">DatabaseConnector::createConnectionDetails()</a></code> function.</p></dd>


<dt>cdmDatabaseSchema</dt>
<dd><p>The name of the database schema that contains the OMOP CDM
instance. Requires read permissions to this database. On SQL
Server, this should specify both the database and the schema,
so for example 'cdm_instance.dbo'.</p></dd>


<dt>workDatabaseSchema</dt>
<dd><p>The name of the database schema where work tables can be created.</p></dd>


<dt>partitionTablePrefix</dt>
<dd><p>The prefix to use when creating table names in the
<code>workDatabaseSChema</code> for storing the person ID and concept ID
partition tables.</p></dd>


<dt>folder</dt>
<dd><p>The folder on the local file system where the Parquet files will
be written.</p></dd>


<dt>sampleSize</dt>
<dd><p>The number of persons to be included in the sample.</p></dd>


<dt>partitions</dt>
<dd><p>The number of partitions. Fewer partitions may lead to memory
issues.</p></dd>


<dt>maxCores</dt>
<dd><p>The maximum number of parallel threads to use.</p></dd>


<dt>forceRestart</dt>
<dd><p>If <code>FALSE</code>, when data is already found in the <code>folder</code> the process
will continue where it left off. If <code>TRUE</code>, any existing data files
will be deleted, and the process will start from scratch.</p></dd>


<dt>dropPartitionTablesWhenDone</dt>
<dd><p>Drop the partition tables when done? If not, they could be
reused for a future data pull.</p></dd>

</dl></div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Martijn Schuemie.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

